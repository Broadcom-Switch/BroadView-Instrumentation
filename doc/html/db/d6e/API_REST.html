<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BroadView&trade; API Guide and Reference Manual: API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BroadView&trade; API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="../../pages.html"><span>BroadViewâ„¢&#160;Documentation</span></a></li>
      <li><a href="../../modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dc/d3f/REST.html">BST REST API</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="../../d3/d3a/CONFIG_CMDS.html">Configuration Commands</a> </li>
<li><a class="el" href="../../df/d4c/STATUS.html">Status / Reporting Commands</a></li>
</ul>
<h1><a class="anchor" id="JSON_RPC"></a>
JSON-RPC Messaging</h1>
<p>The API is REST-based and communicated using JSON-RPC messaging. There are three forms of JSON-RPC messages that are supported by the Agent.</p>
<p>1.Request (From Collector, Received/Processed by Agent), sometimes also called as a Command.</p>
<p>2.Response (From Agent, Received/Processed by Collector, in response to a previous request)</p>
<p>3.Notification (From Agent, Received/Processed by Collector, asynchronously)</p>
<p>An example JSON-RPC request message sample is provided below for illustrative purposes.</p>
<div class="image">
<img src="../../json_1.jpg" alt="json_1.jpg"/>
</div>
<p> A sample JSON-RPC response message is provided below for illustrative purposes.</p>
<div class="image">
<img src="../../json_2.jpg" alt="json_2.jpg"/>
</div>
<p>A notification message is similar to a request message, with the exception that it will not have any id field. More details are available at <a href="http://www.jsonrpc.org/specification">http://www.jsonrpc.org/specification</a>.</p>
<p>When an agent receives a request from the collector, the method field specifies the request that is sent. Any data associated with the request is part of the params field.</p>
<h1><a class="anchor" id="BST_BCGROUND"></a>
Quick BST Backgrounder</h1>
<p>At the heart of the BST feature is a counter, buffer-count, sometime also called as a cell count, or a packet count.</p>
<p>The TD2, TH silicon has various buffers at different places called categories. The ASIC provides means to measure how each of these buffers is being utilized under a given traffic scenario. A collection of all such buffer-counts for various buffers in the ASIC is the Buffer Statistics Tracking report. This BST report is sent from the Agent to Collector either on demand and periodically.</p>
<p>The ASIC allows tracking either the current values of the buffer counts or the peak values of the buffer counts. Also, the ASIC allows some of the categories , called as realms, of the buffer tracking to be disabled.</p>
<p>The ASIC allows setting up thresholds for some of the buffers, and can raise an interrupt when the buffer usage exceeds the configured threshold.</p>
<h1><a class="anchor" id="CONFIG_REST"></a>
Configurability</h1>
<p>The following configurability is provided by the BST feature to the collector.</p>
<p>1.The BST feature can be enabled / disabled on the agent.</p>
<p>2.The BST feature can be configured to auto-accumulate the buffer statistics periodically and send the BST report to the Collector at configurable intervals (as notification messages).</p>
<p>3.The BST feature can provide buffer statistics (BST report) on demand.</p>
<p>4.Buffer statistics collection (in switch and in Agent) of various subsets of buffer statistics (such as device-level, various ingress-groups, etc.) can be selectively disabled / enabled.</p>
<p>5.The ASIC can be setup to gather the statistics of current values or peak values for the statistics.</p>
<p>6.Various thresholds can be setup for the statistics in the ASIC and the current values can be retrieved from the ASIC. The agent can be setup to asynchronously send the buffer statistics when then buffer usage exceeds the configured threshold.</p>
<p>7.The agent can be configured to report the buffer statistics in units of bytes, or in the units of cells.</p>
<p>8.All of the configuration commands are executed on a per-ASIC basis (see section Multi-ASIC platforms below) Any changes made to the feature configuration may come into effect only from next reporting period.</p>
<h1><a class="anchor" id="MULTI_ASIC"></a>
Multi ASIC Platforms</h1>
<p>The agent supports platforms with more than one ASIC device. The configuration command / reporting is on per ASIC basis. The configuration commands and the status reports carry the ASIC identifier as part of the message. For a single ASIC platform, the ASIC identifier part of the configuration command is ignored by the Agent, and the corresponding value is set to 0, for status reports.</p>
<h1><a class="anchor" id="REPORT_REST"></a>
Reporting</h1>
<p>All of the BST reports are time stamped. The time is obtained from the local clock running on the Switch. It may be possible that the clock is 1588 synchronized, but it is beyond the scope of this document. Keeping in mind the extensive data that is likely to be collected and communicated, the following constraints are imposed on the BST reports.</p>
<ul>
<li>All of the on-demand BST reports are complete in nature.</li>
</ul>
<ul>
<li>All of the asynchronous BST reports are incremental in nature. <br/>
 -The BST feature compares the statistics collected in the current cycle, to that of the previous cycle, and marks the changed statistics in its native representation.<br/>
 -The JSON packing from the native representation is aware of the marking, and ignores those statistics that have not changed since last cycle.<br/>
</li>
</ul>
<ul>
<li>Any statistics that are not supported by the underlying ASIC or the SDK are explicitly encoded with special value in the JSON message. These statistics are not included in subsequent asynchronous reports (being incremental).</li>
</ul>
<h1><a class="anchor" id="TIMESTAMP"></a>
Time Stamps</h1>
<p>The periodic reports and the snapshot reports sent by the Agent contain the time stamp which indicates the time at which the data is read from the ASIC. The data is reported in the YYYY-MM-DD - HH:MM:SS format.</p>
<p>A sample JSON report snippet containing a timestamp is provided below.</p>
<div class="image">
<img src="../../time.jpg" alt="time.jpg"/>
</div>
 <h1><a class="anchor" id="BST_VERSION"></a>
Version</h1>
<p>The response message from the agent contains version number. The collector may use the version number information to parse/decipher the response messages from the agent. The version number is incremented every time there is a change in the JSON message format</p>
<h1><a class="anchor" id="THRESOLD_REST"></a>
Reporting Statistics &amp; Thresholds</h1>
<p>The ASIC reports buffer statistics for various on-chip buffers. The buffers are presented under various categories, called realms. To access (statistics of a) a buffer, the realm parameters are to be provided. These parameters act as indices for the given buffer. For example to access a buffer in the egress-uc-queue realm, the parameter is the corresponding queue id. Similarly, to access a buffer in ingress-port-priority-group realm, the parameters are the port id and the priority-group id. The device realm has no indices. No realm has more than two indices.</p>
<p>Each buffer, given its parameters, may have one or more than one statistic. For example, the ingress-port-service-pool realm buffer, for a given port &amp; service pool id, offers a single statistic: um-share-buffer-count. The egress-port-service-pool buffer, for a given port &amp; service pool id, offers four statistics: uc-share-buffer-count, um-share-buffer-count, mc-share-buffer-count, mc-share-queue-entries. Each buffer statistic has an associated threshold for configuration. For example, for the uc-share-buffer-count, there is an associated uc-share-threshold.</p>
<p>The following table provides the list of realms and the associated indices for each of the realm. It also lists all the available statistics for each realm.</p>
<div class="image">
<img src="../../thresh.jpg" alt="thresh.jpg"/>
</div>
<p> The following table provides the list of realms and the associated indices for each of the realm. It also lists all the available statistics for each realm.</p>
<div class="image">
<img src="../../thresh_2.jpg" alt="thresh_2.jpg"/>
</div>
<p> While reporting statistics for a given realm, the statistics names are not included in the report. JSON positional parameter method is used. In addition, one (and not more than one) of the indices is included as the first element in the array. This method is illustrated below with few examples.</p>
<p>Consider the following report snippet:</p>
<div class="image">
<img src="../../stat.jpg" alt="stat.jpg"/>
</div>
<p> The ingress-service-pool has a single index (service pool), and it is mentioned in the JSON array.</p>
<p>This report indicates the following.</p>
<p>The realm is the ingress-service-pool,</p>
<p>The service pool with id 1 has the uc-share-buffer-count value 3240 and</p>
<p>The service pool with id 2 has uc-share-buffer-count value 3660.</p>
<p>Consider the following report snippet:</p>
<div class="image">
<img src="../../ingr_pg.jpg" alt="ingr_pg.jpg"/>
</div>
<p> The ingress-port-priority-group has two indices, port and the priority-group. The top level index (port) is mentioned explicitly and the second index (priority-group) is included as the first element in the JSON array. This report indicates the following.</p>
<ul>
<li>The realm is the ingress-port-priority-group,</li>
</ul>
<ul>
<li><p class="startli">The port # 2 report has the following entries</p>
<ul>
<li><p class="startli">priority-group id 5 has</p>
<ul>
<li>the um-share-buffer-count value 45500 and</li>
<li>the um-headroom-buffer-count value 44450.</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p class="startli">The port # 3 report has the following entries</p>
<ul>
<li><p class="startli">priority-group id 5 has</p>
<ul>
<li>the um-share-buffer-count value 6700 and</li>
<li>the um-headroom-buffer-count value 250.</li>
</ul>
</li>
</ul>
<ul>
<li><p class="startli">priority-group id 7 has</p>
<ul>
<li>the um-share-buffer-count value 12267 and</li>
<li>the um-headroom-buffer-count value 13456</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Similar mechanism is followed for threshold reports.</p>
<p>This scheme is used to reduce the JSON message size for report messages. This scheme is applicable only for reports. For configuration messages to the agent, all parameters are named JSON parameters.</p>
<p>Consider the following report snippet:</p>
<pre>
{
            "realm": "egress-mc-queue",
            "data": [[1, "1", 34, 89], [10, "2", 1244, 0]
}
</pre><p>The egress-mc-queue has single index (queue), it is included as the first element in the JSON array. The second element is .port. to which queue is assigned. This report indicates the following.</p>
<ul>
<li>The realm is the egress-mc-queue,</li>
<li>The Queue #1 and port #1 has the following entries<ol type="1">
<li>the mc-buffer-count value 34 and</li>
<li>the mc-queue-entries value 89.</li>
</ol>
</li>
<li>The Queue #10 and port #2 has the following entries<ol type="1">
<li>the mc-buffer-count value 1244 and</li>
<li>the mc-queue-entries value 0. Consider the following report snippet: <pre>
{
            "realm": "egress-uc-queue",
            "data": [[1, "1", 34]
}
</pre></li>
</ol>
</li>
</ul>
<p>The egress-uc-queue has single index (queue), it is included as the first element in the JSON array. The second element is .port. to which queue is assigned.</p>
<p>This report indicates the following.</p>
<ul>
<li>The realm is the egress-uc-queue,</li>
<li>The Queue #1 and port #1 has the following entries<ol type="1">
<li>the uc-buffer-count value 34</li>
</ol>
</li>
</ul>
<p>The 'port' is included as a second parameter for the buffer usage reports / threshold reports for the egress-uc-queue and egress-mc-queue realms. Similar mechanism is followed for threshold reports.</p>
<h1><a class="anchor" id="REP_ERR"></a>
Reporting Errors</h1>
<p>The agent uses the standard HTTP error reporting mechanism for reporting any errors. The error codes are listed below.</p>
<div class="image">
<img src="../../error.jpg" alt="error.jpg"/>
</div>
<p> Each of the error listed above (HTTP error codes 4xx &amp; 5xx) have JSONRPC payload in the response packet to give additional error details in the following format.</p>
<div class="image">
<img src="../../http_error.jpg" alt="http_error.jpg"/>
</div>
 <h1><a class="anchor" id="SWITCH_PROP_BST"></a>
Switch Properties Command</h1>
<p>The section describes command supported by the BroadView to obtain the Switch properties.</p>
<h2><a class="anchor" id="SWITCH_PROP_GET_BST"></a>
get-switch-properties</h2>
<p>The get-switch-properties command is used to retrieve the Switch properties.</p>
<p>The associated REST URL for this command is as follows:</p>
<p><a href="http://">http://</a>&lt;ipaddr&gt;:8080/broadview/get-switch-properties</p>
<p>A sample JSON-RPC request is shown below. </p>
<pre>
{
    "jsonrpc": "2.0",
    "method": "get-switch-properties",
    "asic-id": "1",
    "params": { },
    "id": 1
}
</pre><p>An associated sample response is shown below. </p>
<pre>
{
    "jsonrpc": "2.0",
    "method": "get-switch-properties",
    "version": "1",
    "result": {
        "number-of-asics": 2,
        "asic-info": [["1","BCM56690_A0", 48], ["2","BCM56690_A0",48]],
        "supported-features": ["BST","PT"],
        "network-os": "SDK"
     },
    "id": 1
}
</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 30 2015 18:57:39 for BroadView&trade; API Guide and Reference Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
