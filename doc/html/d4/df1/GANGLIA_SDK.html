<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BroadView&trade; API Guide and Reference Manual: Ganglia Plugin</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BroadView&trade; API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="../../pages.html"><span>BroadViewâ„¢&#160;Documentation</span></a></li>
      <li><a href="../../modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Ganglia Plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BroadView Instrumentation Agent integrates Ganglia monitoring tool to get BST statistics. The Ganglia monitoring tool runs on separate PC/Server and it gets the data from BroadViewAgent in the REST format. The BroadView Ganglia plugin configures periodic interval and enables BST in the BroadViewAgent via REST mechanism. The BroadViewAgent sends the BST statistics to Ganglia monitoring tool(gmond). The Ganglia web plots the data that can be viewed by user by connecting to Ganglia server over HTTP.</p>
<p>The gmond is installed on ganglia server. There can be multiple gmond running on ganglia server each interacting with one BroadView Agent running at specific target hardware (switch). The diagram below illustrates execution of multiple gmond.</p>
<div class="image">
<img src="../../ganglia_multiple.jpg" alt="ganglia_multiple.jpg"/>
</div>
<p> There is one Primary (P) gmond and multiple secondary (S) gmond. Each of the gmond (primary or secondary) gets the data from a switch. Each of the secondary gmond sends the data to primary gmond. The gmetad receives the data only from primary gmond.</p>
<p>The Ganglia plugin source code is available in the BroadView source code archive at '&lt;broadview&gt;/example/ganglia/.' The source code contains 'gmond' and 'module' code, sample configuration file and scripts to build and install ganglia for collecting BST statistics from BroadViewAgent.</p>
<p><b>Prerequisites</b></p>
<p>Ganglia source code 3.7.1 and Ganglia Web source code 3.7.0 is needed.</p>
<p>Ganglia requires several packages including Apache web server for building, installation and execution. These packages may or may not exist in the build server. So, it is required that the environment should be setup first.</p>
<p>Typically, setup the environment by executing './configure' script on ganglia source code. The script may require several additional packages depending on available packages on the build server and platform. Use Ganglia installation steps which is typically 'make', 'make install' etc and make sure that the graphs are seen.</p>
<pre>
  ./configure --with-gmetad
</pre><p>Typically below mentioned packages would be needed; any additional packages may also be needed depending on the build server environment.</p>
<pre></pre><pre>apt-get install libjson-perl
apt-get install apt-file
apt-get install build-essential automake autoconf pkg-config
apt-get install gperf libtool
apt-get install rrdtool librrd-dev libconfuse-dev  libpcre3-dev
apt-get install libapr1 libapr1-dev libaprutil1-dev
apt-get install php-pear
apt-get install apache2
apt-get install php5 php5-gd</pre><pre></pre><p><b>Running BroadViewAgent</b></p>
<p>Running BroadViewAgent is explained in another section.So, the configuration file for Agent should be as mentioned below. The parameter 'bview_client_port' is the port number where gmond listen</p>
<p>bview_client_ip=&lt;ganglia IP address&gt;<br/>
 bview_client_port=9808<br/>
 agent_port=8080<br/>
</p>
<p><b>Installing Additional Packages:</b></p>
<p>Ganglia compilation process requires additional packages be installed on ganglia server. These are</p>
<ul>
<li>gengetopt<ul>
<li>apt-get install gengetopt</li>
</ul>
</li>
<li>jsonlint<ul>
<li>apt-get install python-demjson</li>
</ul>
</li>
</ul>
<p><b>Running Apache</b></p>
<p>Ganglia requires Apache web server be running so make sure Apache is already running.</p>
<p><b>Plugin BST with Ganglia</b></p>
<p>Plugging in BST with Ganglia requires a number of steps. The steps include copying the ganglia BST plugin code to Ganglia source tree, configuration, building the source code, installation and execution. These are mentioned below.</p>
<ul>
<li><p class="startli">Create a directory &lt;ganglia&gt; This is the root directory which should contain Ganglia open source code, Ganglia web source code and Ganglia BST code.</p>
<p class="startli"># mkdir &lt;ganglia&gt;</p>
</li>
</ul>
<ul>
<li><p class="startli">Extract the ganglia source code from open source forum to &lt;ganglia&gt; directory</p>
<p class="startli"># cd &lt;ganglia&gt;<br/>
 # tar -xzf ganglia-3.7.1.tar.gz<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Extract the ganglia web source code from open source forum to &lt;ganglia&gt; directory</p>
<p class="startli"># tar -xzf ganglia-web-3.7.0.tar.gz<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Copy the file 'ganglia-3.7.1-p1.patch' from BroadView source archive &lt;broadview&gt;/example/ganglia to &lt;ganglia&gt; directory and apply the patch on Ganglia source code.</p>
<p class="startli"># cd &lt;ganglia&gt;<br/>
 # cp &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/ganglia-3.7.1-p1.patch .<br/>
 # patch -p1 &lt; ganglia-3.7.1-p1.patch<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Copy the file 'ganglia-web-3.7.0-p1.patch' from BroadView source archive &lt;broadview&gt;/example/ganglia to &lt;ganglia&gt; directory and apply the patch on Ganglia web source code.</p>
<p class="startli"># cd &lt;ganglia&gt;<br/>
 # cp &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/ganglia-3.7.0-p1.patch .<br/>
 # patch -p1 &lt; ganglia-web-3.7.0-p1.patch<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Copy the directory 'bst_app' from BroadView source archive &lt;broadview&gt;/example/ganglia to &lt;ganglia&gt;/ganglia-3.7.1/gmond</p>
<p class="startli"># cd &lt;ganglia&gt;/ganglia-3.7.1/gmond<br/>
 # cp -R &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/bst_app .<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Copy files 'cJSON.c' and 'cJSON.h' from BroadView source archive &lt;broadview&gt;/vendor/cjson/cJSON.c and &lt;broadview&gt;/vendor/cjson/cJSON.h respectively to &lt;ganglia&gt;/ganglia-3.7.1/gmond/bst_app</p>
<p class="startli"># cd &lt;ganglia&gt;/ganglia-3.7.1/gmond/bst_app<br/>
 # cp -R &lt;local_dir&gt;/&lt;broadview&gt;/vendor/cjson/cJSON.* .<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Copy the directory 'bst' from BroadView source archive &lt;broadview&gt;/example/ganglia/modules to &lt;ganglia&gt;/ganglia-3.7.1/gmond/modules</p>
<p class="startli"># cd &lt;ganglia&gt;/ganglia-3.7.1/gmond/modules<br/>
 # cp -R &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/modules/bst .<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Copy various scripts, configurations and json files (compile_install.sh, gen_bst_metrics.sh, gen_gmond_primary.sh, gen_gmond_secondary.sh, gen_bst_metrics.pl, gen_gmond_primary.pl, gen_gmond_secondary.pl, gmond_src_primary.conf, gmond_src_secondary.conf, metric_input.json, switch_conf.json) from BroadView source archive .&lt;broadview&gt;/example/ganglia. to &lt;ganglia&gt; directory.</p>
<p class="startli"># cd &lt;ganglia&gt;<br/>
 # cp &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/*.sh .<br/>
 # cp &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/*.pl .<br/>
 # cp &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/*.conf .<br/>
 # cp &lt;local_dir&gt;/&lt;broadview&gt;/example/ganglia/*.json .<br/>
</p>
</li>
</ul>
<ul>
<li>Specify all metrics to be displayed on Ganglia web in metric_input.json. This is a super set of all metrics to be collected from individual switch/gmond.</li>
</ul>
<pre></pre><pre>   "metricinfo" : [
      { "metric": "bst_device_data_NONE_NONE", "shortname": "DeviceStat", "color": "33cccc"},
      { "metric": "bst_ingress-port-priority-group_um-share-buffer-count_37_7", "shortname": "ippg_umhb_37_7", "color": "335555"},
      { "metric": "bst_ingress-service-pool_um-share-buffer-count_0_NONE", "shortname": "ipsp_umsb_0", "color": "cc5555"},
      { "metric": "bst_ingress-port-priority-group_um-share-buffer-count_38_7", "shortname": "ippg_umhb_38_7", "color": "775555"}
     ]
</pre><p><b>metricinfo attribute</b> This attribute is used to collect and display specific statistics on Ganglia web. The string for 'metric' field has to be in a specific format. The string encoding format is</p>
<p>bst_&lt;realm&gt;_&lt;name&gt;_&lt;index1&gt;_&lt;index2&gt;</p>
<p>The following table provides the list of realms and the associated indices for each of the realm. It also lists all the available statistics for each realm.</p>
<div class="image">
<img src="../../ganglia_table_1.jpg" alt="ganglia_table_1.jpg"/>
</div>
<p> The following conditions apply</p>
<ol type="1">
<li>The &lt;realm&gt; can be any of the supported realms from above tables for the statistics.</li>
<li>The &lt;name&gt; should be the name of the corresponding stat parameter from the tables above.</li>
<li>The &lt;index1&gt;, &lt;index2&gt; must contain the values for the appropriate indices (as required by the corresponding statistics).</li>
</ol>
<p>Note: For the statistics, where one or both of the indices are not required, the string NONE should be used as the indices.</p>
<ul>
<li><p class="startli">Run the script 'compile_install.sh'. The script performs building and installing ganglia. The script auto generates few files..</p>
<p class="startli"># cd &lt;ganglia&gt;<br/>
 # ./compile_install.sh<br/>
</p>
</li>
</ul>
<p>Make sure these files are generated successfully by above script. </p>
<pre>
&lt;ganglia&gt;/ganglia-web-3.7.0/conf/default.json
&lt;ganglia&gt;/ganglia-web-3.7.0/graph.d/bst_report.json
</pre><p>The location where libganglia.so.0 is installed must be included along with other library paths.</p>
<ul>
<li><p class="startli">Run 'gmetad'</p>
<p class="startli"># gmetad</p>
</li>
</ul>
<ul>
<li>Edit switch config JSON file. The switch config JSON file contains configparams attribute.</li>
</ul>
<pre>
{
"name" : "switch-1",
   "configparams" : [
      { "param": "agent_ip", "value": "10.130.86.31"},
      { "param": "agent_port", "value": "8080"},
      { "param": "bstapp_local_port", "value": "9808"},
      { "param": "polling_interval", "value": "2"}
   ]
}
</pre><p><b>name attribute:</b> This attribute is name of the switch. The name should be unique for each switch. The name should always be in small letters.</p>
<p><b>configparams attribute</b> This attribute is used to communicate with Agent/switch. The attribute contains IP address and port number of the agent. It also contains the port number where gmond listen (bstapp_local_port) and polling interval for getting data from the switch.</p>
<ul>
<li><p class="startli">Run Primary gmond with the command mentioned in the output of following shell script</p>
<p class="startli"># sh gen_gmond_primary.sh switch_conf.json <br/>
 # &lt;Run gmond using the command mentioned in the output of above command&gt; <br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Edit switch config JSON file (alternatively create another copy say switch_conf_2.json) for every secondary gmond and specify name, agent IP, port number and poling interval for second switch. Run Secondary gmond with the command mentioned in the output of following shell script</p>
<p class="startli"># cp switch_conf.json switch_conf_2.json <br/>
 # &lt;edit switch_conf_2.json&gt; <br/>
 # sh gen_gmond_secondary.sh switch_conf_2.json <br/>
 # &lt; Run gmond using the command mentioned in the output of above command &gt; <br/>
</p>
</li>
</ul>
<p><b>Changing metrics and switch parameter and re-running</b></p>
<p>Follow below steps to change metric and re-running gmetad and gmond.</p>
<ul>
<li><p class="startli">Killall gmond and gmetad</p>
<p class="startli"># killall gmetad gmond<br/>
</p>
</li>
</ul>
<ul>
<li>Change the metric in the metric_input.json file</li>
</ul>
<ul>
<li><p class="startli">Execute below command</p>
<p class="startli"># cd &lt;ganglia&gt;<br/>
 # sh gen_bst_metrics.sh <br/>
 # gmetad<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Edit switch config json file for changing switch IP, port number etc. Run Primary gmond with the command mentioned in the output of following shell script</p>
<p class="startli"># sh gen_gmond_primary.sh switch_conf.json <br/>
 # &lt;Run gmond using the command mentioned in the output of gen_gmond_primary.sh&gt;<br/>
</p>
</li>
</ul>
<ul>
<li><p class="startli">Edit switch config JSON file (alternatively create another copy say switch_conf_2.json) for every secondary gmond and edit name, agent IP, port number and poling interval for second switch. Run Secondary gmond with the command mentioned in the output of following shell script</p>
<p class="startli"># cp switch_conf.json switch_conf_2.json <br/>
 # &lt;edit switch_conf_2.json&gt; <br/>
 # sh gen_gmond_secondary.sh switch_conf_2.json <br/>
 # &lt;Run gmond using the command mentioned in the output of above command&gt; <br/>
</p>
</li>
</ul>
<p><b>Viewing web page</b></p>
<p>To View web page, connect to Ganglia Server via web (<a href="http://">http://</a>&lt;IP&gt;/ganglia/). This shows BST graph. A sample BST graph is shown below.</p>
<div class="image">
<img src="../../ganglia_graph.jpg" alt="ganglia_graph.jpg"/>
</div>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 30 2015 18:57:39 for BroadView&trade; API Guide and Reference Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
